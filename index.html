<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mind Game â€“ Touch Fix</title>
<style>
  :root{--bg:#0f1226;--card:#171b39;--line:#2b316c;--text:#f3f5ff;--muted:#c9cdf6;--accent:#7c9cff;--accent2:#6fffe9;}
  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:#0f1226;color:var(--text);}
  .wrap{max-width:900px;margin:0 auto;padding:16px}
  .card{background:linear-gradient(180deg,#1a1f44,#14183a);border:1px solid var(--line);border-radius:16px;padding:14px;margin-top:14px}
  .btn{background:linear-gradient(180deg,#7c9cff,#8fe3ff);color:#0b0e1d;font-weight:800;border:none;border-radius:14px;padding:12px 16px;cursor:pointer;touch-action:manipulation}
  .btn:active{transform:scale(.98)}
  .kbd{background:#0e1233;border:1px solid #2b316c;border-bottom-width:3px;border-radius:12px;padding:10px 14px;cursor:pointer;touch-action:manipulation}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:640px){.grid{grid-template-columns:1fr}}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .muted{color:var(--muted)}
  .big{font-size:22px;font-weight:900}
  button, .kbd{pointer-events:auto}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="big">Mind Game â€“ <span style="color:var(--accent2)">Touch Fix</span></div>
    <div class="muted">Dokunma uyumlu sÃ¼rÃ¼m. â€œHemen Oynaâ€ ile baÅŸla.</div>
    <div class="row" style="margin-top:8px">
      <button id="quick" class="btn">âš¡ Hemen Oyna</button>
      <button id="restart" class="kbd">ğŸ”„ Yeniden BaÅŸlat</button>
    </div>
  </div>

  <div id="hud" class="card">
    <div>Puan: <b id="score">0</b> â€¢ Seviye: <b id="level">1</b> â€¢ SÃ¼re: <b id="time">â€”</b></div>
    <div class="muted">DoÄŸru â†’ +30 puan, +20 XP â€¢ YanlÄ±ÅŸ/SÃ¼re â†’ seri bozulur</div>
  </div>

  <div id="area" class="card" aria-live="polite">
    <div class="muted">BaÅŸlamak iÃ§in â€œHemen Oynaâ€.</div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
const on=(el,ev,fn)=>{el.addEventListener(ev,fn,{passive:true})};
const state={level:1,xp:0,score:0,timer:null,tLeft:0,round:false};

document.body.style.touchAction='manipulation';

function xpNeed(l){return 80+(l-1)*20;}
function addXP(v){state.xp+=v;const need=xpNeed(state.level);if(state.xp>=need){state.xp-=need;state.level++;$('#level').textContent=state.level;}}

function startTimer(s,onEnd){
  state.tLeft=s;$('#time').textContent=state.tLeft+'s';
  clearInterval(state.timer);
  state.timer=setInterval(()=>{
    state.tLeft--;
    $('#time').textContent=state.tLeft+'s';
    if(state.tLeft<=0){
      clearInterval(state.timer);state.timer=null;state.round=false;
      onEnd&&onEnd();
    }
  },1000)
}

function task_logic(){
  const a=rand(5,20), b=rand(2,12);
  const ops=['+','-','Ã—']; const op=ops[rand(0,2)];
  const ans=op==='+'?a+b:op==='-'?a-b:a*b;
  const choices=shuffle([ans,ans+rand(1,3),ans-rand(1,3)]);

  $('#area').innerHTML=
  `<div class="big">MantÄ±k-Matematik</div>
   <div style="font-size:26px;margin:8px 0">${a} ${op} ${b} = ?</div>
   <div class="grid">${choices.map(c=>`<button class="kbd opt" data-v="${c}">${c}</button>`).join('')}</div>`;

  bindOptions(v=>+v===ans);
  state.round=true;
  startTimer(15,()=>{message("SÃ¼re doldu.");setTimeout(next,600);});
}

function task_verbal(){
  const bank=[
    {d:'KÄ±sa ve Ã¶z anlatÄ±m',w:'veciz'},
    {d:'Bir sorunu Ã§Ã¶zmek iÃ§in izlenen yÃ¶ntem',w:'strateji'},
    {d:'Derin dÃ¼ÅŸÃ¼nme',w:'tefekkÃ¼r'},
    {d:'Bir iÅŸi yapma gÃ¼cÃ¼',w:'kabiliyet'}
  ];
  const pick=bank[rand(0,bank.length-1)];
  const wrongs=shuffle(bank.filter(x=>x.w!==pick.w)).slice(0,2).map(x=>x.w);
  const choices=shuffle([pick.w,...wrongs]);

  $('#area').innerHTML=
  `<div class="big">SÃ¶zel-Dil</div>
   <div style="margin:8px 0">${pick.d}</div>
   <div class="grid">${choices.map(c=>`<button class="kbd opt" data-v="${c}">${c}</button>`).join('')}</div>`;

  bindOptions(v=>v===pick.w);
  state.round=true;
  startTimer(18,()=>{message("SÃ¼re doldu.");setTimeout(next,600);});
}

function task_spatial(){
  const size=3,len=Math.min(2+Math.floor(state.level/2),6);
  const cells=[...Array(size*size)].map((_,i)=>i);
  const seq=[];for(let i=0;i<len;i++)seq.push(cells[rand(0,cells.length-1)]);

  $('#area').innerHTML=
  `<div class="big">GÃ¶rsel-Uzamsal (HafÄ±za)</div>
   <div id="grid" style="display:grid;grid-template-columns:repeat(3,90px);gap:8px;margin-top:8px"></div>
   <div class="muted">SÄ±ralamayÄ± tekrarla.</div>`;

  const grid=$('#grid');
  cells.forEach(i=>{
    const b=document.createElement('button');
    b.className='kbd opt'; b.style.width='90px'; b.style.height='90px'; b.dataset.i=i;
    const h=()=>pick(i);
    on(b,'click',h);on(b,'touchstart',h);
    grid.appendChild(b);
  });

  let viewIdx=0,input=[];
  function show(){
    const i=seq[viewIdx];
    const b=grid.children[i];
    b.style.background='#7c9cff';
    setTimeout(()=>{
      b.style.background='';
      viewIdx++;
      if(viewIdx<seq.length) setTimeout(show,300); else state.round=true;
    },300)
  }
  setTimeout(show,300);

  function pick(i){
    if(!state.round)return;
    input.push(i);
    if(input.length===seq.length){
      if(input.every((v,k)=>v===seq[k]))win();
      else lose("SÄ±ra yanlÄ±ÅŸ.");
    }
  }
  startTimer(25,()=>{lose("SÃ¼re doldu.");});
}

function bindOptions(check){
  document.querySelectorAll('.opt').forEach(btn=>{
    const act=()=>{
      if(!state.round)return;
      check(btn.dataset.v)?win():lose("YanlÄ±ÅŸ.");
    };
    on(btn,'click',act);on(btn,'touchstart',act);
  })
}

function message(t){
  const p=document.createElement('div');
  p.className='muted'; p.textContent=t;
  $('#area').appendChild(p);
}

function win(){
  state.score+=30+10*state.level;
  addXP(20+5*state.level);
  $('#score').textContent=state.score;
  next();
}

function lose(t){
  state.round=false;message(t);
  setTimeout(next,600);
}

const tasks=[task_logic,task_verbal,task_spatial];
function next(){ $('#level').textContent=state.level; tasks[rand(0,tasks.length-1)](); }

function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function shuffle(a){return a.sort(()=>Math.random()-.5);}

function start(){
  state.level=1;state.xp=0;state.score=0;
  $('#score').textContent='0';$('#level').textContent='1';
  next();
}

on($('#quick'),'click',start);
on($('#quick'),'touchstart',start);
on($('#restart'),'click',start);
on($('#restart'),'touchstart',start);
</script>
</body>
</html>
